<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Deployment exercise ⚙️ - kubernetes-docker-lab</title>
<meta name="description" content="Learning how to deploy a web app from Docker to Kubernetes to GCloud">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="kubernetes-docker-lab">
<meta property="og:title" content="Deployment exercise ⚙️">
<meta property="og:url" content="http://localhost:4000/k8s/deployment/example.html">













<link rel="canonical" href="http://localhost:4000/k8s/deployment/example.html">













<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="kubernetes-docker-lab Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">kubernetes-docker-lab</a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Docker</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docker/intro" class="">Introduction to docker</a></li>
          
            
            

            
            

            <li><a href="/docker/example" class="">Example of deployment with Docker</a></li>
          
            
            

            
            

            <li><a href="/k8s/swarm" class="">Docker swarm</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Kubernetes knowledges</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/k8s/architecture" class="">Architecture</a></li>
          
            
            

            
            

            <li><a href="/k8s/deployment" class="">Deployment</a></li>
          
            
            

            
            

            <li><a href="/k8s/services" class="">Service</a></li>
          
            
            

            
            

            <li><a href="/k8s/storage" class="">Volumes</a></li>
          
            
            

            
            

            <li><a href="/k8s/cron" class="">Cron task</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Deploying an app to minikube</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/k8s/minikube" class="">Minikube</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Deployment exercise ⚙️">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Deployment exercise ⚙️
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>We saw many theorical information. Now it’s time to apply these knowledges in a small project example. Today our example is a simple web app which need to be deploy with Kubernetes. Each layer of the app need to be deploy seperately within the same cluster due to Minikube’s limitation.</p>

<ul>
  <li>front: a small front-end made with VueJS</li>
  <li>back: a small back-end which contain Rest API made with Go</li>
  <li>database: a simple MySQL database with only one table</li>
</ul>

<h2 id="how-are-we-going-to-deploy-this-web-app">How are we going to deploy this web app</h2>

<p>Based on what we learn so far. We know that a cluster is made of several Nodes where in each of these Nodes there are multiples pods which are managed by the Kubelet. Moreover we also saw different kind of deployment that allow us to manage the behavior of our pods by using different type of controller.</p>

<ul>
  <li>stateless: nothing is stored which can be useful for the api and the front</li>
  <li>we need to have the same amount of pods available so that if one fail the other can take the load</li>
  <li>for our convenience we need to be able to update, rollback our deployment if anything happened</li>
</ul>

<p>Based on the types of deployment we know the one that fits the best is the <code class="highlighter-rouge">deployment</code> types at least for the front and the api.</p>

<h2 id="how-about-the-database-">How about the database ?</h2>

<p>Our database is a statefull kind of service. With Kubernetes we have the option to create a stateful service with the <code class="highlighter-rouge">statefulSet</code> controller. However the community is divide at the idea of running a database in Kubernetes.</p>

<p>A deep explanation has been made on the subreddit of Kubernetes. <strong>Credits to nkrgovic for it’s detailed explanation</strong></p>

<blockquote>
  <p>Stateful services, especially databases, rely on keeping state on a reliable media - in most cases disk (ssd or spinning rust). Also, in most cases, database performance is a big issue affecting system performance. This is partly due to design, and partly due to inherent inability of relational databases to scale horizontally.</p>
</blockquote>

<blockquote>
  <p>Simple put, the most common bottleneck in databases is the disk performance. In order to get good database performance you need disk performance. This means predictable latency and good throughput - which usually means dedicated volumes with QoS, not sharing out of a pool.</p>
</blockquote>

<blockquote>
  <p>Other issues have to do with databases using a lot of memory, and also not being good to spin up and spin down new instances quickly, exactly because of the state: They need to copy the entire data set over and that takes time.</p>
</blockquote>

<blockquote>
  <p>When you put all those together a relational database is a very bad candidate for running in a container - it just doesn’t make sense. If you have a lot of data spinning up and down, starting, everything takes time, and a lot of time.</p>
</blockquote>

<blockquote>
  <p>If you have a little bit of data, like in a test or CI environment, then database in a container is a great tool. But in a production environment databases and containers just don’t mix.</p>
</blockquote>

<p>Moreover Kelsey Hightower a developer advocate on the GCP advise to also not use Kubernetes for deploying a database. See his <a href="https://twitter.com/kelseyhightower/status/963413508300812295?lang=en">tweet</a></p>

<p>At first glance we thought that it would be a good idea to connect a local database hosted on your computer. However due to the network isolation that minikube does like Docker it wouldn’t be possible to do this kind of infrastructure. Futhermore this is only a small database with one table for testing purposes. Thus deploying the database within the Kubernetes environment is not a big issue.</p>

<h2 id="lets-deploy-">Let’s deploy !</h2>

<p>Yes let’s deploy first by deploying the <a href="/k8s/deployment/front.html">front-end</a>. A link for the next part will be available on each of the next articles</p>

<h2 id="accessing-to-the-project">Accessing to the project</h2>

<p>As you have a LoadBalancer available by running the <code class="highlighter-rouge">minikube tunnel</code> you should be able to access to the front-end by using the IP address that minikube has generated.</p>

<p>Minikube should have generate an address with a bitmask of 12 like the image below</p>

<p align="center">
  <img src="../../img/balancing.png" alt="drawing" width="350" />  
</p>

<p>Now get the service of the front-end by running</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get services
</code></pre></div></div>

<p>You should see the <code class="highlighter-rouge">External IP</code> for the bobba-vue services. Copy and paste it into your browser and you should be able to access to the front like the image below</p>

<p align="center">
  <img src="../../img/screen.png" alt="drawing" width="550" />  
</p>

<h2 id="crontask">CronTask</h2>

<p>If you want to deploy a CronTask a guide based on our example is available <a href="/k8s/deployment/cron.html">here</a></p>

<h2 id="cleanup-">Cleanup 🔌</h2>

<p>Now that you have finish the deployment it’s important to cleanup it’s workspace.</p>

<p>First remove the services by running this command</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete service &lt;service_name&gt;
</code></pre></div></div>

<p>then delete the deployemnts</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete deployment &lt;deployment_name&gt;
</code></pre></div></div>

<p>then delete the stateful sets</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete statefulset &lt;statefulset_name&gt;
</code></pre></div></div>

<p>then delete the pvc sets</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete pvc &lt;pvc_name&gt;
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 kubernetes-docker-lab. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
