<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Kubernetes architecture - kubernetes-docker-lab</title>
<meta name="description" content="Learning how to deploy a web app from Docker to Kubernetes to GCloud">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="kubernetes-docker-lab">
<meta property="og:title" content="Kubernetes architecture">
<meta property="og:url" content="http://localhost:4000/k8s/architecture.html">













<link rel="canonical" href="http://localhost:4000/k8s/architecture.html">













<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="kubernetes-docker-lab Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">kubernetes-docker-lab</a>
        <ul class="visible-links"></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Docker</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docker/intro" class="">Introduction to docker</a></li>
          
            
            

            
            

            <li><a href="/docker/example" class="">Example of deployment with Docker</a></li>
          
            
            

            
            

            <li><a href="/k8s/swarm" class="">Docker swarm</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Kubernetes knowledges</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/k8s/architecture" class="">Architecture</a></li>
          
            
            

            
            

            <li><a href="/k8s/deployment" class="">Deployment</a></li>
          
            
            

            
            

            <li><a href="/k8s/services" class="">Service</a></li>
          
            
            

            
            

            <li><a href="/k8s/storage" class="">Volumes</a></li>
          
            
            

            
            

            <li><a href="/k8s/cron" class="">Cron task</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Deploying an app to minikube</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/k8s/minikube" class="">Minikube</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Kubernetes architecture">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Kubernetes architecture
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>In this article we‚Äôll take a look at Kubernetes‚Äôs architecture. This will enable us to understand how Kubernetes is working.</p>

<h2 id="type-of-architecture-">Type of architecture üîç</h2>

<p>Kubernetes is based on the master-slave architecture.
A master-slave architecture is a type of architecture where the <code class="highlighter-rouge">master</code> components decide the actions which will influence the task that will do <code class="highlighter-rouge">slave</code> components.</p>

<p>Within Kubernetes the <code class="highlighter-rouge">master</code> is name <code class="highlighter-rouge">master components</code>. Slaves components are named <code class="highlighter-rouge">node components</code>.</p>

<p>Within each of these layers there are multiples components that we‚Äôll look into. These components are represented within this schema below  üõ†Ô∏è:</p>

<p align="center">
  <img src="../img/architecture.png" alt="drawing" width="800" />
</p>
<p align="center"><b>Kubernetes architecture</b></p>

<h2 id="components-Ô∏è">Components üõ†Ô∏è</h2>

<h3 id="cluster">Cluster</h3>

<p>The cluster is a environment where you‚Äôre deploying your application. It contain the master components as well as multiples nodes which are direct by the master components.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It's possible to create a virtual Cluster called Namespace. It's used for application where the load is important which is not the case for this learning tutorial
</code></pre></div></div>

<p>Below is the representation of the cluster</p>

<p align="center">
  <img src="../img/cluster.svg" alt="cluster" width="500" />
</p>
<p align="center"><b>Cluster representation, Kubernetes documentation</b></p>

<h3 id="master-components-Ô∏è">Master components ‚öôÔ∏è</h3>

<p>Master components are a set of components which are running within the Cluster. These master components are pretty much the brain of the Cluster and therefore are critical components to Kubernetes.</p>

<h4 id="kube-api-server">Kube-api-server</h4>

<p>Kube-api-server is a critial component of the Kubernetes architecture. The Kube-api-server is an API use by every components of the <strong>master components</strong>. It‚Äôs also use by the kubelet process which is located in the Node.</p>

<p>So how does it works ‚ùî. Kube-api-server is a simple REST API which it‚Äôs main purposes is to validate, saving Kubernetes‚Äôs cluster state. It‚Äôs also use for saving metadata, configuration of your pods &amp; services</p>

<p>As Kube-api-server is stateless (does not save any datas). Kube-api-server is tightly coupled to an external database component also located in the <em>master</em> named <strong>Etcd</strong>. See etcd section for more information.</p>

<p>In order to understand how crucial Kube-api-server is important. Please take a look at the schema below:</p>

<p align="center">
  <img src="../img/pod_flow.png" alt="drawing" width="500" />  
</p>
<p align="center"><b>Create Pod Flow: Source: heptio.com</b></p>

<h4 id="etcd">Etcd</h4>

<p>Etcd is a high performance key value database written in Go. This database is only use by kube-api-server in order to save the state of the cluster of your cluster. I suggest you to read this good article about what does Etcd: <a href="https://matthewpalmer.net/kubernetes-app-developer/articles/how-does-kubernetes-use-etcd.html">How kubernetes use etcd</a></p>

<p>Moreover if you‚Äôre curious about how works Etcd you could check the repo <a href="https://github.com/etcd-io/etcd">Etcd repo</a></p>

<h4 id="controller-manager">Controller manager</h4>

<p>The controller manager is a daemon (a background process) which is located on the master.</p>

<p>What it does is that it watches for any changes on the state of the cluster by querying <code class="highlighter-rouge">kube-api-server</code>. If any changes happened the controller manager will move the current state to the desired state.</p>

<p>The controller manager is actually a list of several controller launch in a single process 
the list of controllers use by the controller manager is available <a href="https://github.com/kubernetes/kubernetes/blob/6671d2556f1af67e703c329b1186896d7c6f9f4d/cmd/kube-controller-manager/app/controllermanager.go#L339">over here</a></p>

<p>For a full technical description of the controller here is the definition right from the Kubernetes documentation:</p>

<blockquote>
  <p>In Kubernetes, a controller is a control loop that watches the shared state of the cluster through the API server and makes changes attempting to move the current state towards the desired state. Examples of controllers that ship with Kubernetes today are the replication controller, endpoints controller, namespace controller, and serviceaccounts controller.</p>
</blockquote>

<h4 id="scheduler">Scheduler</h4>

<p>The scheduler is an other component of the <strong>master component</strong>. It‚Äôs task is to watch for unscheduled pod. When an unscheduled pod pops up, the scheduler will try to find the proper node. It will try to to bind to a node it depending on several criteria</p>

<p>Binding an unscheduled pod to a node happened through the <code class="highlighter-rouge">/binding</code> subresources. While this seems to be a bit obscure an article with tremendous amount of knowledges regarding the Scheduler is avalaible <a href="https://kublr.com/blog/implementing-advanced-scheduling-techniques-with-kubernetes/">here</a></p>

<h4 id="cloud-controller-manager">Cloud controller manager</h4>

<p>The cloud controller manager is a manager for cloud specific control loops. This controller manager allow cloud provider to make their own set of controller while satisfying the cloud controller interfaces. (E.g, a foo cloud provider implement their own node controller)</p>

<p>A list of available controller is available here: <a href="https://github.com/kubernetes/kubernetes/blob/6671d2556f1af67e703c329b1186896d7c6f9f4d/cmd/cloud-controller-manager/app/controllermanager.go#L270">Cloud controller manager</a></p>

<h3 id="node-components">Node components</h3>

<p>Node components refer to the components running into a Node. A Node is the second layer of Kubernetes (slave in the master-slave architecture) where your pods are running. Pods are controlled and monitored by Kubelet</p>

<p align="center"> 
  <img src="../img/nodes.svg" alt="drawing" width="400" />
</p>
<p align="center"><b>Representation of a Node. Kubernetes documentation</b></p>

<h4 id="kubelet">Kubelet</h4>

<p>The kubelet is the main component of the Node which is located on each Node.</p>

<p>It‚Äôs purpose is to watch continuously the state of the pods and to send these information such as monitoring back to the kube-api-server. Kubelet is also responsible at taking the proper action if something happened to a pod e.g: restarting a pod when a pod is getting shutdown.</p>

<p>TL;DR Kubelet is responsible of:</p>

<ul>
  <li>Run the pods container on the right engine</li>
  <li>Restart the pod if failure happened</li>
  <li>Report status of the node and each pod to kube api-server</li>
  <li>Retrieve metrics from the pods container</li>
</ul>

<h4 id="kube-proxy">Kube proxy</h4>

<p>The Kube proxy is a component which it‚Äôs purpose is to watch changes in the definition of the service of the pods in order to maintain the desired network configuration by querying kube-api-server.</p>

<p>This component also expose the pod to the correct back-end which allow you to exposes the pods by manipulating the iptables and assigning IP addresses so that you can easily access to your pods</p>

<h4 id="container-runtime">Container runtime</h4>

<p>The container runtime is the engine use for running the container pod. E.g: docker, rkt and many more‚Ä¶</p>

<h2 id="pod">Pod</h2>

<p>A pod is the basic component of Kubernetes. This is the component where your container is running. It‚Äôs represent as a process within the Kubernetes cluster.</p>

<p>What does it contain ? Kubernetes does a good job at documenting what it does</p>

<blockquote>
  <p>A Pod encapsulates an application container (or, in some cases, multiple containers), storage resources, a unique network IP, and options that govern how the container(s) should run. A Pod represents a unit of deployment: a single instance of an application in Kubernetes, which might consist of either a single container or a small number of containers that are tightly coupled and that share resources.</p>
</blockquote>

<p>As cited earlier a pod can contain one or multiple container. Note that Kubernetes recommended to use only one pod per container which is easier to manage.</p>

<p>However combining container can be useful for communication and storage problematic. E.g, helper container or proxy container.</p>

<p>Within the pods world there are 3 kinds of multiple containers strategy. I‚Äôd recommend you to check the article made by Matthew Palmer which describe precisely each of these patterns <a href="https://matthewpalmer.net/kubernetes-app-developer/articles/multi-container-pod-design-patterns.html">design pattern multiple containers</a></p>

<h2 id="resources-used">Resources used</h2>

<p><a href="https://elastisys.com/wp-content/uploads/2018/01/kubernetes-ha-setup.pdf?x83281">Description of kubernetes architecture</a></p>

<p><a href="https://kubernetes.io/docs/concepts/overview/components/">Kubernetes documentation</a></p>

<p><a href="https://medium.com/jorgeacetozi/kubernetes-master-components-etcd-api-server-controller-manager-and-scheduler-3a0179fc8186">Learning kubernetes architetcture</a></p>

<p><a href="https://kublr.com/blog/implementing-advanced-scheduling-techniques-with-kubernetes/">Scheduler detailed explanation</a></p>

<p><a href="https://engineering.bitnami.com/articles/a-deep-dive-into-kubernetes-controllers.html">Creating it‚Äôs own controller</a></p>

<p><a href="https://matthewpalmer.net/kubernetes-app-developer/articles/multi-container-pod-design-patterns.html">Design pattern used for managing multiple containers</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 kubernetes-docker-lab. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
